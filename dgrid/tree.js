//>>built
define("dgrid/tree","dojo/_base/declare,dojo/_base/array,dojo/_base/Deferred,dojo/query,dojo/on,dojo/aspect,./Grid,dojo/has!touch?./util/touch,put-selector/put".split(","),function(v,q,r,o,s,g,t,k,i){return function(c){var u=c.renderCell||t.defaultRenderCell,p,e;c.shouldExpand=c.shouldExpand||function(b,c,d){return d};g.after(c,"init",function(){var b=c.grid,l=".dgrid-content .dgrid-column-"+c.id,d,f=[];if(!b.store)throw Error("dgrid tree column plugin requires a store to operate.");if(!c.renderExpando)c.renderExpando=
function(a,b,d){var j=this.grid.isRTL?"right":"left",f=".dgrid-expando-icon";b&&(f+=".ui-icon.ui-icon-triangle-1-"+(d?"se":"e"));return i("div"+f+"[style=margin-"+j+": "+a*(c.indentWidth||9)+"px; float: "+j+"]")};f.push(b.on(c.expandOn||".dgrid-expando-icon:click,"+l+":dblclick,"+l+":keydown",function(a){("keydown"!=a.type||32==a.keyCode)&&!("dblclick"==a.type&&e&&1<e.count&&b.row(a).id==e.id&&-1<a.target.className.indexOf("dgrid-expando-icon"))&&b.expand(this);-1<a.target.className.indexOf("dgrid-expando-icon")&&
(e&&e.id==b.row(a).id?e.count++:e={id:b.row(a).id,count:1})}));k&&f.push(b.on(k.selector(l,k.dbltap),function(){b.expand(this)}));if(!b._expanded)b._expanded={};f.push(g.after(b,"insertRow",function(a){var b=this.row(a);c.shouldExpand(b,p,this._expanded[b.id])&&this.expand(a,!0,!0);return a}));f.push(g.before(b,"removeRow",function(a,c){var d=a.connected;d&&(o(">.dgrid-row",d).forEach(function(a){b.removeRow(a,!0)}),c||i(d,"!"))}));b._calcRowHeight=function(a){var b=a.connected;return a.offsetHeight+
(b?b.offsetHeight:0)};b.expand=function(a,c,f){var j=a.element?a:b.row(a),a=j.element;if((a=-1<a.className.indexOf("dgrid-expando-icon")?a:o(".dgrid-expando-icon",a)[0])&&a.mayHaveChildren){var e=void 0===c?!this._expanded[j.id]:c;a.className="dgrid-expando-icon ui-icon ui-icon-triangle-1-"+(e?"se":"e");var l=a.preloadNode,c=j.element,h;if(!l){h=c.connected=i("div.dgrid-tree-container");var l=a.preloadNode=i(c,"+",h,"div.dgrid-preload"),g=function(a){return b.store.getChildren(j.data,a)};g.level=
a.level;r.when(b.renderQuery?b._trackError(function(){return b.renderQuery(g,l)}):b.renderArray(g({}),l),function(){if(b._expanded[j.id]){var a=h.scrollHeight;h.style.height=a?a+"px":"auto"}});var k=function(a){var b=this.style.height;if(b)this.style.display="0px"==b?"none":"block";a?(i(this,".dgrid-tree-resetting"),setTimeout(function(){i(h,"!dgrid-tree-resetting")}),d=!0):d||(d=!1);this.style.height=""};s(h,"transitionend,webkitTransitionEnd,oTransitionEnd,MSTransitionEnd",k);d||setTimeout(function(){k.call(h)},
600)}h=c.connected;h.hidden=!e;var m=h.style,n;!1===d||f?(m.display=e?"block":"none",m.height=""):(e?(m.display="block",n=h.scrollHeight,m.height="0px"):(i(h,".dgrid-tree-resetting"),m.height=h.scrollHeight+"px"),setTimeout(function(){i(h,"!dgrid-tree-resetting");m.height=e?n?n+"px":"auto":"0px"}));e?this._expanded[j.id]=!0:delete this._expanded[j.id]}};g.after(c,"destroy",function(){q.forEach(f,function(a){a.remove()});delete b.expand})});c.renderCell=function(b,e,d,f){var a=c.grid,g=Number(f&&f.query&&
f.query.level)+1,k=!a.store.mayHaveChildren||a.store.mayHaveChildren(b),g=p=isNaN(g)?0:g,a=c.renderExpando(g,k,a._expanded[a.store.getIdentity(b)]);a.innerHTML="&nbsp;";a.level=g;a.mayHaveChildren=k;(b=u.call(c,b,e,d,f))&&b.nodeType?(i(d,a),i(d,b)):d.insertBefore(a,d.firstChild)};return c}});